<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outrigger SEO Audit Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-card: #161b22;
            --bg-card-hover: #1c2128;
            --border-color: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --accent-purple: #a855f7;
            --accent-purple-hover: #9333ea;
            --accent-cyan: #22d3ee;
            --accent-green: #22c55e;
            --accent-orange: #f97316;
            --accent-pink: #ec4899;
        }
        body { background-color: var(--bg-dark); color: var(--text-primary); }
        .bg-dark { background-color: var(--bg-dark); }
        .bg-card { background-color: var(--bg-card); }
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-accent { color: var(--accent-cyan); }
        .border-card { border-color: var(--border-color); }
        .tab-active { background-color: var(--accent-purple); color: white; }
        .tab-inactive { background-color: transparent; color: var(--text-secondary); border: 1px solid var(--border-color); }
        .tab-inactive:hover { background-color: var(--bg-card-hover); color: var(--text-primary); }
        .btn-primary { background-color: var(--accent-purple); }
        .btn-primary:hover { background-color: var(--accent-purple-hover); }
        .btn-cyan { background-color: var(--accent-cyan); color: var(--bg-dark); }
        .btn-cyan:hover { background-color: #06b6d4; }
        .btn-green { background-color: var(--accent-green); color: var(--bg-dark); }
        .btn-green:hover { background-color: #16a34a; }
        .btn-orange { background-color: var(--accent-orange); color: white; }
        .btn-orange:hover { background-color: #ea580c; }
        .btn-pink { background-color: var(--accent-pink); color: white; }
        .btn-pink:hover { background-color: #db2777; }
        .card { background-color: var(--bg-card); border: 1px solid var(--border-color); }
        .card:hover { background-color: var(--bg-card-hover); }
        .input-dark { background-color: var(--bg-dark); border-color: var(--border-color); color: var(--text-primary); }
        .input-dark:focus { border-color: var(--accent-purple); outline: none; box-shadow: 0 0 0 2px rgba(168, 85, 247, 0.3); }
        .input-dark::placeholder { color: var(--text-secondary); }
        /* Grid background effect */
        .grid-bg {
            background-image:
                linear-gradient(rgba(48, 54, 61, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(48, 54, 61, 0.3) 1px, transparent 1px);
            background-size: 50px 50px;
        }
    </style>
</head>
<body class="min-h-screen bg-dark grid-bg">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="card rounded-xl shadow-2xl p-8 w-full max-w-md mx-4">
            <div class="text-center mb-8">
                <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-primary">SEO / GEO</h1>
                <p class="text-accent text-lg font-medium">Optimizer</p>
                <p class="text-secondary mt-2 text-sm">Admin Dashboard</p>
            </div>

            <form id="loginForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-secondary mb-1">Email</label>
                    <input type="email" id="loginEmail"
                           class="w-full input-dark border rounded-lg px-4 py-3"
                           placeholder="your.name@outrigger.com" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-secondary mb-1">Password</label>
                    <input type="password" id="loginPassword"
                           class="w-full input-dark border rounded-lg px-4 py-3"
                           placeholder="Enter password" required>
                </div>
                <div id="loginError" class="text-red-400 text-sm hidden"></div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-medium transition">
                    Sign In
                </button>
            </form>

            <p class="text-center text-secondary text-xs mt-6">
                Access restricted to @outrigger.com accounts
            </p>
        </div>
    </div>

    <!-- Main App (hidden until authenticated) -->
    <div id="mainApp" class="hidden">
    <!-- Header -->
    <header class="bg-card border-b border-card">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-cyan-400 flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-primary">SEO / GEO <span class="text-accent">Optimizer</span></h1>
                        <p class="text-sm text-secondary">Configure audit rules and brand standards</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Last Run Status -->
                    <div id="lastRunStatus" class="flex items-center gap-2 text-sm">
                        <span class="text-secondary">Last run:</span>
                        <span id="lastRunTime" class="text-primary">Loading...</span>
                    </div>
                    <!-- Run Audit Button -->
                    <button onclick="runAuditNow()" id="runAuditBtn" class="btn-primary px-4 py-1.5 rounded-lg text-sm font-medium transition flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Run Audit Now
                    </button>
                    <div id="connectionStatus" class="flex items-center gap-2 text-sm text-secondary">
                        <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                        <span>Connecting...</span>
                    </div>
                    <div class="flex items-center gap-2 border-l border-card pl-4">
                        <span id="userEmail" class="text-sm text-secondary"></span>
                        <button onclick="logout()" class="text-secondary hover:text-primary px-3 py-1 rounded text-sm transition">
                            Logout
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-card border-b border-card">
        <div class="max-w-7xl mx-auto px-4 py-3">
            <div class="flex gap-2">
                <button onclick="showTab('seo')" id="tab-seo" class="px-5 py-2 font-medium transition-all tab-active rounded-lg text-sm">
                    SEO/GEO Rules
                </button>
                <button onclick="showTab('voice')" id="tab-voice" class="px-5 py-2 font-medium transition-all tab-inactive rounded-lg text-sm">
                    Voice &amp; Tone
                </button>
                <button onclick="showTab('brand')" id="tab-brand" class="px-5 py-2 font-medium transition-all tab-inactive rounded-lg text-sm">
                    Brand Standards
                </button>
                <button onclick="showTab('logs')" id="tab-logs" class="px-5 py-2 font-medium transition-all tab-inactive rounded-lg text-sm">
                    Audit Logs
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- SEO/GEO Rules Tab -->
        <div id="panel-seo" class="tab-panel">
            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary">SEO/GEO Check Rules</h2>
                    <button onclick="addSeoRule()" class="btn-primary text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium">
                        <span>+</span> Add Rule
                    </button>
                </div>
                <div id="seoRulesList" class="space-y-3">
                    <p class="text-secondary text-center py-8">Loading rules...</p>
                </div>
            </div>
        </div>

        <!-- Voice & Tone Tab -->
        <div id="panel-voice" class="tab-panel hidden">
            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary">Voice &amp; Tone Guidelines</h2>
                    <button onclick="addVoiceRule()" class="btn-green text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium">
                        <span>+</span> Add Guideline
                    </button>
                </div>
                <div id="voiceRulesList" class="space-y-3">
                    <p class="text-secondary text-center py-8">Loading guidelines...</p>
                </div>
            </div>
        </div>

        <!-- Brand Standards Tab -->
        <div id="panel-brand" class="tab-panel hidden">
            <div class="card rounded-xl p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary">Brand Standards</h2>
                    <button onclick="addBrandStandard()" class="btn-orange text-white px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium">
                        <span>+</span> Add Standard
                    </button>
                </div>
                <div id="brandStandardsList" class="space-y-3">
                    <p class="text-secondary text-center py-8">Loading standards...</p>
                </div>
            </div>
        </div>

        <!-- Audit Logs Tab -->
        <div id="panel-logs" class="tab-panel hidden">
            <div class="card rounded-xl p-6 mb-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-primary">Audit Run History</h2>
                    <button onclick="loadAuditLogs()" class="btn-cyan px-4 py-2 rounded-lg flex items-center gap-2 text-sm font-medium">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                        Refresh
                    </button>
                </div>
                <div id="auditLogsList" class="space-y-4">
                    <p class="text-secondary text-center py-8">Loading audit logs...</p>
                </div>
            </div>
        </div>
    </main>
    </div><!-- End mainApp -->

    <!-- Modal for Adding/Editing -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 hidden items-center justify-center z-50">
        <div class="card rounded-xl shadow-2xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <h3 id="modalTitle" class="text-xl font-bold text-primary mb-4">Add Rule</h3>
                <form id="modalForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-1">Name</label>
                        <input type="text" id="formName" class="w-full input-dark border rounded-lg px-3 py-2" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-secondary mb-1">Description <span class="text-secondary/60 font-normal">(shown in dashboard)</span></label>
                        <textarea id="formDescription" rows="2" class="w-full input-dark border rounded-lg px-3 py-2" required></textarea>
                    </div>
                    <div id="extraFields"></div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="formEnabled" class="w-4 h-4 rounded bg-dark border-card accent-purple-500" checked>
                        <label for="formEnabled" class="text-sm text-secondary">Enabled</label>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg flex-1 font-medium">Save</button>
                        <button type="button" onclick="closeModal()" class="bg-card border border-card text-secondary hover:text-primary px-6 py-2 rounded-lg transition">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ============ AUTHENTICATION ============
        const AUTH_COOKIE_NAME = 'outrigger_auth';
        const AUTH_COOKIE_DAYS = 30;
        const VALID_PASSWORD = 'outrigger2026';
        const VALID_DOMAIN = '@outrigger.com';

        // Cookie helpers
        function setCookie(name, value, days) {
            const expires = new Date();
            expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
            document.cookie = name + '=' + encodeURIComponent(value) + ';expires=' + expires.toUTCString() + ';path=/;SameSite=Strict';
        }

        function getCookie(name) {
            const nameEQ = name + '=';
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return decodeURIComponent(c.substring(nameEQ.length, c.length));
            }
            return null;
        }

        function deleteCookie(name) {
            document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/';
        }

        // Check authentication on page load
        function checkAuth() {
            const authData = getCookie(AUTH_COOKIE_NAME);
            if (authData) {
                try {
                    const { email, expires } = JSON.parse(authData);
                    if (email && email.toLowerCase().endsWith(VALID_DOMAIN) && new Date(expires) > new Date()) {
                        showApp(email);
                        return true;
                    }
                } catch (e) {
                    console.error('Invalid auth cookie');
                }
            }
            showLogin();
            return false;
        }

        // Show login screen
        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainApp').classList.add('hidden');
        }

        // Show main app
        function showApp(email) {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            document.getElementById('userEmail').textContent = email;
            loadAllData();
            loadLastRunTime();
        }

        // Cloud Run API URL
        const API_URL = 'https://outrigger-seo-audit-22338575803.us-central1.run.app';

        // Load last run time from Firestore
        function loadLastRunTime() {
            db.collection('auditLogs').orderBy('timestamp', 'desc').limit(1).get()
                .then(function(snapshot) {
                    if (snapshot.empty) {
                        document.getElementById('lastRunTime').textContent = 'Never';
                    } else {
                        var lastLog = snapshot.docs[0].data();
                        if (lastLog.timestamp) {
                            var date = lastLog.timestamp.toDate();
                            var timeAgo = getTimeAgo(date);
                            document.getElementById('lastRunTime').textContent = timeAgo;
                            document.getElementById('lastRunTime').title = date.toLocaleString();
                        } else {
                            document.getElementById('lastRunTime').textContent = 'Unknown';
                        }
                    }
                })
                .catch(function(error) {
                    console.error('Error loading last run time:', error);
                    document.getElementById('lastRunTime').textContent = 'Error';
                });
        }

        // Get human-readable time ago string
        function getTimeAgo(date) {
            var seconds = Math.floor((new Date() - date) / 1000);
            var interval = Math.floor(seconds / 31536000);
            if (interval >= 1) return interval + ' year' + (interval > 1 ? 's' : '') + ' ago';
            interval = Math.floor(seconds / 2592000);
            if (interval >= 1) return interval + ' month' + (interval > 1 ? 's' : '') + ' ago';
            interval = Math.floor(seconds / 86400);
            if (interval >= 1) return interval + ' day' + (interval > 1 ? 's' : '') + ' ago';
            interval = Math.floor(seconds / 3600);
            if (interval >= 1) return interval + ' hour' + (interval > 1 ? 's' : '') + ' ago';
            interval = Math.floor(seconds / 60);
            if (interval >= 1) return interval + ' minute' + (interval > 1 ? 's' : '') + ' ago';
            return 'Just now';
        }

        // Run audit now
        function runAuditNow() {
            var btn = document.getElementById('runAuditBtn');
            var originalContent = btn.innerHTML;

            // Update button to show loading state
            btn.disabled = true;
            btn.innerHTML = '<svg class="w-4 h-4 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Running...';
            btn.classList.add('opacity-75');

            // Make POST request to trigger audit
            fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(function(response) {
                return response.json();
            })
            .then(function(data) {
                console.log('Audit completed:', data);

                // Show success message
                if (data.status === 'success') {
                    var results = data.results;
                    alert('Audit completed!\n\n' +
                          'Pages audited: ' + results.pages + '\n' +
                          'Issues found: ' + results.issues + '\n' +
                          'Tasks created: ' + results.tasks_created + '\n' +
                          'Duplicates skipped: ' + results.duplicates_skipped);

                    // Refresh last run time and logs
                    loadLastRunTime();
                    if (currentTab === 'logs') {
                        loadAuditLogs();
                    }
                } else {
                    alert('Audit completed with status: ' + data.status);
                }
            })
            .catch(function(error) {
                console.error('Error running audit:', error);
                alert('Error running audit: ' + error.message);
            })
            .finally(function() {
                // Restore button
                btn.disabled = false;
                btn.innerHTML = originalContent;
                btn.classList.remove('opacity-75');
            });
        }

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim().toLowerCase();
            const password = document.getElementById('loginPassword').value;
            const errorEl = document.getElementById('loginError');

            // Validate email domain
            if (!email.endsWith(VALID_DOMAIN)) {
                errorEl.textContent = 'Access restricted to @outrigger.com email addresses';
                errorEl.classList.remove('hidden');
                return;
            }

            // Validate password
            if (password !== VALID_PASSWORD) {
                errorEl.textContent = 'Invalid password';
                errorEl.classList.remove('hidden');
                return;
            }

            // Success - set cookie for 30 days
            const expires = new Date();
            expires.setTime(expires.getTime() + (AUTH_COOKIE_DAYS * 24 * 60 * 60 * 1000));
            const authData = JSON.stringify({ email: email, expires: expires.toISOString() });
            setCookie(AUTH_COOKIE_NAME, authData, AUTH_COOKIE_DAYS);

            errorEl.classList.add('hidden');
            showApp(email);
        }

        // Logout
        function logout() {
            deleteCookie(AUTH_COOKIE_NAME);
            showLogin();
            document.getElementById('loginEmail').value = '';
            document.getElementById('loginPassword').value = '';
        }

        // Attach login form handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            checkAuth();
        });

        // ============ FIREBASE & APP CODE ============

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDu4Ka6oFSUOH_7PAZW7k9-2u46SlmbBWE",
            authDomain: "project-85d26db5-f70f-487e-b0e.firebaseapp.com",
            projectId: "project-85d26db5-f70f-487e-b0e",
            storageBucket: "project-85d26db5-f70f-487e-b0e.firebasestorage.app",
            messagingSenderId: "22338575803",
            appId: "1:22338575803:web:58fef3f290892f25c5f89e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // State
        let currentTab = 'seo';
        let currentEditId = null;
        let currentCollection = null;

        // Update connection status
        function updateConnectionStatus(connected) {
            var statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-green-400"></span><span>Connected to Firestore</span>';
            } else {
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-red-400"></span><span>Connection Error</span>';
            }
        }

        // Tab Navigation
        function showTab(tabName) {
            currentTab = tabName;
            var tabs = ['seo', 'voice', 'brand', 'logs'];
            tabs.forEach(function(tab) {
                var tabBtn = document.getElementById('tab-' + tab);
                var panel = document.getElementById('panel-' + tab);
                if (tab === tabName) {
                    tabBtn.className = 'px-5 py-2 font-medium transition-all tab-active rounded-lg text-sm';
                    panel.classList.remove('hidden');
                } else {
                    tabBtn.className = 'px-5 py-2 font-medium transition-all tab-inactive rounded-lg text-sm';
                    panel.classList.add('hidden');
                }
            });
            // Load logs when switching to that tab
            if (tabName === 'logs') {
                loadAuditLogs();
            }
        }

        // Load SEO Rules
        function loadSeoRules() {
            var container = document.getElementById('seoRulesList');
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Loading rules...</p>';

            db.collection('seoRules').orderBy('name').get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">No SEO rules configured. Click "Add Rule" to create one.</p>';
                        return;
                    }
                    var html = '';
                    snapshot.forEach(function(doc) {
                        var rule = doc.data();
                        html += createRuleCard(doc.id, rule, 'seo');
                    });
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading SEO rules:', error);
                    updateConnectionStatus(false);
                    container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading rules. Check console for details.</p>';
                });
        }

        // Load Voice Rules
        function loadVoiceRules() {
            var container = document.getElementById('voiceRulesList');
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Loading guidelines...</p>';

            db.collection('voiceRules').orderBy('name').get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">No voice guidelines configured. Click "Add Guideline" to create one.</p>';
                        return;
                    }
                    var html = '';
                    snapshot.forEach(function(doc) {
                        var rule = doc.data();
                        html += createRuleCard(doc.id, rule, 'voice');
                    });
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading voice rules:', error);
                    updateConnectionStatus(false);
                    container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading guidelines. Check console for details.</p>';
                });
        }

        // Load Brand Standards
        function loadBrandStandards() {
            var container = document.getElementById('brandStandardsList');
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Loading standards...</p>';

            db.collection('brandStandards').orderBy('name').get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">No brand standards configured. Click "Add Standard" to create one.</p>';
                        return;
                    }
                    var html = '';
                    snapshot.forEach(function(doc) {
                        var standard = doc.data();
                        html += createRuleCard(doc.id, standard, 'brand');
                    });
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading brand standards:', error);
                    updateConnectionStatus(false);
                    container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading standards. Check console for details.</p>';
                });
        }

        // Load Audit Logs
        function loadAuditLogs() {
            var container = document.getElementById('auditLogsList');
            container.innerHTML = '<p class="text-secondary text-center py-8">Loading audit logs...</p>';

            db.collection('auditLogs').orderBy('timestamp', 'desc').limit(20).get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-secondary text-center py-8">No audit logs yet. Run an audit to see results here.</p>';
                        return;
                    }
                    var html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">';
                    snapshot.forEach(function(doc) {
                        var log = doc.data();
                        html += createLogCard(doc.id, log);
                    });
                    html += '</div>';
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading audit logs:', error);
                    container.innerHTML = '<p class="text-red-400 text-center py-8">Error loading logs. Check console for details.</p>';
                });
        }

        // Create audit log card HTML (matching the design from screenshot)
        function createLogCard(id, log) {
            var timestamp = log.timestamp ? new Date(log.timestamp.toDate()).toLocaleString() : 'Unknown';
            var pagesAudited = log.pagesAudited || 0;
            var totalIssues = log.totalIssues || 0;
            var tasksCreated = log.tasksCreated || 0;
            var duplicatesSkipped = log.duplicatesSkipped || 0;

            // Calculate completion percentage (tasks created / total issues)
            var completionPct = totalIssues > 0 ? Math.round((tasksCreated / totalIssues) * 100) : 100;

            // Issue breakdown
            var seoIssues = log.seoIssues || 0;
            var voiceIssues = log.voiceIssues || 0;
            var brandIssues = log.brandIssues || 0;

            return '<div class="card rounded-xl p-5">' +
                '<div class="flex justify-between items-start mb-4">' +
                    '<div>' +
                        '<h3 class="font-bold text-primary text-lg">Audit Run</h3>' +
                        '<p class="text-secondary text-sm">' + timestamp + '</p>' +
                    '</div>' +
                    '<div class="text-right">' +
                        '<span class="text-2xl font-bold text-accent">' + completionPct + '%</span>' +
                        '<p class="text-secondary text-xs">Complete</p>' +
                    '</div>' +
                '</div>' +
                '<div class="space-y-2 mb-4">' +
                    '<div class="flex justify-between text-sm">' +
                        '<span class="text-secondary">Pages Audited</span>' +
                        '<span class="text-primary font-medium">' + pagesAudited + '</span>' +
                    '</div>' +
                    '<div class="flex justify-between text-sm">' +
                        '<span class="text-secondary">Issues Found</span>' +
                        '<span class="text-primary font-medium">' + totalIssues + '</span>' +
                    '</div>' +
                '</div>' +
                '<div class="text-xs text-secondary mb-3">Issue Breakdown</div>' +
                '<div class="grid grid-cols-2 gap-2 mb-4">' +
                    '<div class="flex items-center gap-2">' +
                        '<span class="w-2 h-2 rounded-full bg-purple-500"></span>' +
                        '<span class="text-secondary text-sm">SEO/GEO</span>' +
                        '<span class="text-primary text-sm ml-auto">' + seoIssues + '</span>' +
                    '</div>' +
                    '<div class="flex items-center gap-2">' +
                        '<span class="w-2 h-2 rounded-full bg-green-500"></span>' +
                        '<span class="text-secondary text-sm">Voice/Tone</span>' +
                        '<span class="text-primary text-sm ml-auto">' + voiceIssues + '</span>' +
                    '</div>' +
                    '<div class="flex items-center gap-2">' +
                        '<span class="w-2 h-2 rounded-full bg-orange-500"></span>' +
                        '<span class="text-secondary text-sm">Brand</span>' +
                        '<span class="text-primary text-sm ml-auto">' + brandIssues + '</span>' +
                    '</div>' +
                    '<div class="flex items-center gap-2">' +
                        '<span class="w-2 h-2 rounded-full bg-gray-500"></span>' +
                        '<span class="text-secondary text-sm">Duplicates</span>' +
                        '<span class="text-primary text-sm ml-auto">' + duplicatesSkipped + '</span>' +
                    '</div>' +
                '</div>' +
                '<div class="space-y-2">' +
                    '<div>' +
                        '<div class="flex justify-between text-xs mb-1">' +
                            '<span class="text-green-400">Tasks Created</span>' +
                            '<span class="text-green-400">' + Math.round((tasksCreated / Math.max(totalIssues, 1)) * 100) + '%</span>' +
                        '</div>' +
                        '<div class="h-2 bg-dark rounded-full overflow-hidden">' +
                            '<div class="h-full bg-green-500 rounded-full" style="width: ' + Math.round((tasksCreated / Math.max(totalIssues, 1)) * 100) + '%"></div>' +
                        '</div>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        // Create rule card HTML
        function createRuleCard(id, data, type) {
            var statusClass = data.enabled ? 'bg-green-500/20 text-green-400' : 'bg-gray-500/20 text-gray-400';
            var statusText = data.enabled ? 'Enabled' : 'Disabled';
            var borderColor = type === 'seo' ? 'border-l-purple-500' : (type === 'voice' ? 'border-l-green-500' : 'border-l-orange-500');

            // Badge for LLM-powered rules
            var llmBadge = '';
            if (data.prompt) {
                llmBadge = '<span class="px-2 py-1 text-xs rounded-full bg-purple-500/20 text-purple-400">AI-Powered</span>';
            }

            // Severity badge for SEO rules
            var severityBadge = '';
            if (data.severity) {
                var severityClass = {
                    'Critical': 'bg-red-500/20 text-red-400',
                    'High': 'bg-orange-500/20 text-orange-400',
                    'Medium': 'bg-yellow-500/20 text-yellow-400',
                    'Low': 'bg-blue-500/20 text-blue-400'
                }[data.severity] || 'bg-gray-500/20 text-gray-400';
                severityBadge = '<span class="px-2 py-1 text-xs rounded-full ' + severityClass + '">' + data.severity + '</span>';
            }

            return '<div class="card rounded-lg p-4 ' + borderColor + ' border-l-4 hover:bg-card-hover transition-all">' +
                '<div class="flex justify-between items-start">' +
                    '<div class="flex-1">' +
                        '<div class="flex items-center gap-2 mb-2 flex-wrap">' +
                            '<h3 class="font-semibold text-primary">' + escapeHtml(data.name) + '</h3>' +
                            '<span class="px-2 py-1 text-xs rounded-full ' + statusClass + '">' + statusText + '</span>' +
                            severityBadge +
                            llmBadge +
                        '</div>' +
                        '<p class="text-secondary text-sm">' + escapeHtml(data.description) + '</p>' +
                    '</div>' +
                    '<div class="flex gap-2 ml-4">' +
                        '<button onclick="editRule(\'' + type + '\', \'' + id + '\')" class="text-accent hover:bg-card-hover p-2 rounded transition">Edit</button>' +
                        '<button onclick="deleteRule(\'' + type + '\', \'' + id + '\')" class="text-red-400 hover:bg-red-500/10 p-2 rounded transition">Delete</button>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        // Escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Modal functions
        function openModal(title, collection) {
            currentCollection = collection;
            currentEditId = null;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('formName').value = '';
            document.getElementById('formDescription').value = '';
            document.getElementById('formEnabled').checked = true;
            document.getElementById('extraFields').innerHTML = '';
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
            currentEditId = null;
            currentCollection = null;
        }

        // Add functions
        function addSeoRule() {
            openModal('Add SEO/GEO Rule', 'seoRules');
            document.getElementById('extraFields').innerHTML =
                '<div class="mb-4">' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Check Type <span class="text-gray-400 font-normal">(identifier)</span></label>' +
                    '<select id="formCheckType" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="title">Title Tag</option>' +
                        '<option value="meta">Meta Description</option>' +
                        '<option value="h1">H1 Heading</option>' +
                        '<option value="canonical">Canonical Tag</option>' +
                        '<option value="schema">Schema/Structured Data</option>' +
                        '<option value="content">Content Quality</option>' +
                        '<option value="geo">Geo Meta Tags</option>' +
                        '<option value="og">Open Graph Tags</option>' +
                        '<option value="alt">Image Alt Tags</option>' +
                        '<option value="robots">Robots Meta Tag</option>' +
                        '<option value="custom">Custom (LLM-only)</option>' +
                    '</select>' +
                '</div>' +
                '<div class="mb-4">' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Severity</label>' +
                    '<select id="formSeverity" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="Critical">Critical</option>' +
                        '<option value="High">High</option>' +
                        '<option value="Medium" selected>Medium</option>' +
                        '<option value="Low">Low</option>' +
                    '</select>' +
                '</div>' +
                '<div class="mb-4">' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">LLM Audit Prompt <span class="text-gray-400 font-normal">(optional - enables AI-powered checking)</span></label>' +
                    '<textarea id="formPrompt" rows="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent font-mono text-sm" placeholder="Describe what the AI should check for. Example:\n\nCheck if this page has a proper <title> tag. The rule FAILS if:\n1. The page is missing a <title> tag\n2. The title is less than 30 characters\n3. The title is generic like &quot;Home&quot;"></textarea>' +
                    '<p class="text-xs text-gray-500 mt-1">When a prompt is provided, Claude AI will evaluate the page against this rule dynamically. Leave empty to use built-in hardcoded checks.</p>' +
                '</div>';
        }

        function addVoiceRule() {
            openModal('Add Voice Guideline', 'voiceRules');
            document.getElementById('extraFields').innerHTML =
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Category</label>' +
                    '<select id="formCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="tone">Tone of Voice</option>' +
                        '<option value="language">Language Style</option>' +
                        '<option value="audience">Target Audience</option>' +
                        '<option value="messaging">Key Messaging</option>' +
                    '</select>' +
                '</div>';
        }

        function addBrandStandard() {
            openModal('Add Brand Standard', 'brandStandards');
            document.getElementById('extraFields').innerHTML =
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Standard Type</label>' +
                    '<select id="formStandardType" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="visual">Visual Identity</option>' +
                        '<option value="terminology">Terminology</option>' +
                        '<option value="compliance">Compliance</option>' +
                        '<option value="accessibility">Accessibility</option>' +
                    '</select>' +
                '</div>';
        }

        // Edit rule
        function editRule(type, id) {
            var collectionName = type === 'seo' ? 'seoRules' : (type === 'voice' ? 'voiceRules' : 'brandStandards');
            currentCollection = collectionName;
            currentEditId = id;

            db.collection(collectionName).doc(id).get()
                .then(function(doc) {
                    if (doc.exists) {
                        var data = doc.data();
                        document.getElementById('modalTitle').textContent = 'Edit ' + data.name;
                        document.getElementById('formName').value = data.name || '';
                        document.getElementById('formDescription').value = data.description || '';
                        document.getElementById('formEnabled').checked = data.enabled !== false;

                        // Build extra fields based on type
                        if (type === 'seo') {
                            document.getElementById('extraFields').innerHTML =
                                '<div class="mb-4">' +
                                    '<label class="block text-sm font-medium text-gray-700 mb-1">Check Type</label>' +
                                    '<select id="formCheckType" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                                        '<option value="title"' + (data.checkType === 'title' ? ' selected' : '') + '>Title Tag</option>' +
                                        '<option value="meta"' + (data.checkType === 'meta' ? ' selected' : '') + '>Meta Description</option>' +
                                        '<option value="h1"' + (data.checkType === 'h1' ? ' selected' : '') + '>H1 Heading</option>' +
                                        '<option value="canonical"' + (data.checkType === 'canonical' ? ' selected' : '') + '>Canonical Tag</option>' +
                                        '<option value="schema"' + (data.checkType === 'schema' ? ' selected' : '') + '>Schema/Structured Data</option>' +
                                        '<option value="content"' + (data.checkType === 'content' ? ' selected' : '') + '>Content Quality</option>' +
                                        '<option value="geo"' + (data.checkType === 'geo' ? ' selected' : '') + '>Geo Meta Tags</option>' +
                                        '<option value="og"' + (data.checkType === 'og' ? ' selected' : '') + '>Open Graph Tags</option>' +
                                        '<option value="alt"' + (data.checkType === 'alt' ? ' selected' : '') + '>Image Alt Tags</option>' +
                                        '<option value="robots"' + (data.checkType === 'robots' ? ' selected' : '') + '>Robots Meta Tag</option>' +
                                        '<option value="custom"' + (data.checkType === 'custom' ? ' selected' : '') + '>Custom (LLM-only)</option>' +
                                    '</select>' +
                                '</div>' +
                                '<div class="mb-4">' +
                                    '<label class="block text-sm font-medium text-gray-700 mb-1">Severity</label>' +
                                    '<select id="formSeverity" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                                        '<option value="Critical"' + (data.severity === 'Critical' ? ' selected' : '') + '>Critical</option>' +
                                        '<option value="High"' + (data.severity === 'High' ? ' selected' : '') + '>High</option>' +
                                        '<option value="Medium"' + (data.severity === 'Medium' || !data.severity ? ' selected' : '') + '>Medium</option>' +
                                        '<option value="Low"' + (data.severity === 'Low' ? ' selected' : '') + '>Low</option>' +
                                    '</select>' +
                                '</div>' +
                                '<div class="mb-4">' +
                                    '<label class="block text-sm font-medium text-gray-700 mb-1">LLM Audit Prompt <span class="text-gray-400 font-normal">(optional)</span></label>' +
                                    '<textarea id="formPrompt" rows="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent font-mono text-sm">' + escapeHtml(data.prompt || '') + '</textarea>' +
                                    '<p class="text-xs text-gray-500 mt-1">When a prompt is provided, Claude AI will evaluate the page against this rule dynamically.</p>' +
                                '</div>';
                        } else {
                            document.getElementById('extraFields').innerHTML = '';
                        }

                        document.getElementById('modal').classList.remove('hidden');
                        document.getElementById('modal').classList.add('flex');
                    }
                })
                .catch(function(error) {
                    console.error('Error loading rule:', error);
                    alert('Error loading rule for editing');
                });
        }

        // Delete rule
        function deleteRule(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;

            var collectionName = type === 'seo' ? 'seoRules' : (type === 'voice' ? 'voiceRules' : 'brandStandards');

            db.collection(collectionName).doc(id).delete()
                .then(function() {
                    loadAllData();
                })
                .catch(function(error) {
                    console.error('Error deleting:', error);
                    alert('Error deleting item');
                });
        }

        // Form submission
        document.getElementById('modalForm').addEventListener('submit', function(e) {
            e.preventDefault();

            var data = {
                name: document.getElementById('formName').value,
                description: document.getElementById('formDescription').value,
                enabled: document.getElementById('formEnabled').checked,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Add extra fields based on collection
            var checkType = document.getElementById('formCheckType');
            var category = document.getElementById('formCategory');
            var standardType = document.getElementById('formStandardType');
            var severity = document.getElementById('formSeverity');
            var prompt = document.getElementById('formPrompt');

            if (checkType) data.checkType = checkType.value;
            if (category) data.category = category.value;
            if (standardType) data.standardType = standardType.value;
            if (severity) data.severity = severity.value;
            if (prompt && prompt.value.trim()) {
                data.prompt = prompt.value.trim();
            }

            var savePromise;
            if (currentEditId) {
                savePromise = db.collection(currentCollection).doc(currentEditId).update(data);
            } else {
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                savePromise = db.collection(currentCollection).add(data);
            }

            savePromise
                .then(function() {
                    closeModal();
                    loadAllData();
                })
                .catch(function(error) {
                    console.error('Error saving:', error);
                    alert('Error saving: ' + error.message);
                });
        });

        // Load all data
        function loadAllData() {
            loadSeoRules();
            loadVoiceRules();
            loadBrandStandards();
        }

        // Seed default rules (run once to populate)
        async function seedDefaultRules() {
            if (!confirm('This will add all recommended SEO/GEO rules with AI-powered prompts. Continue?')) return;

            const seoRules = [
                // TIER 1: CRITICAL - All with LLM prompts
                {
                    name: 'Title Tag Check',
                    checkType: 'title',
                    description: 'Checks for missing or too-short title tags. Title should be 50-60 characters and include primary keywords.',
                    prompt: 'Check if this page has a proper <title> tag. The rule FAILS if:\n1. The page is missing a <title> tag entirely, OR\n2. The title is empty or contains only whitespace, OR\n3. The title is less than 30 characters (too short to be descriptive), OR\n4. The title is generic like "Home" or "Page" without context\n\nFor a hotel/hospitality site, a good title should include the property name, location, and ideally brand.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                {
                    name: 'Meta Description Check',
                    checkType: 'meta',
                    description: 'Checks for missing or too-short meta descriptions. Should be 150-160 characters with compelling copy.',
                    prompt: 'Check if this page has a proper meta description. The rule FAILS if:\n1. The page is missing a <meta name="description"> tag, OR\n2. The meta description content is empty, OR\n3. The meta description is less than 120 characters (too short), OR\n4. The meta description is over 160 characters (will be truncated)\n\nFor a hotel site, meta descriptions should be compelling and include a call-to-action.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                {
                    name: 'H1 Tag Check',
                    checkType: 'h1',
                    description: 'Checks for missing H1 tags or multiple H1s. Each page should have exactly one H1.',
                    prompt: 'Check if this page has proper H1 heading structure. The rule FAILS if:\n1. The page has NO <h1> tag at all, OR\n2. The page has MORE than one <h1> tag (should have exactly one), OR\n3. The H1 is empty or contains only whitespace\n\nBest practice: Each page should have exactly one H1 that clearly describes the main topic.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                {
                    name: 'Canonical Tag Check',
                    checkType: 'canonical',
                    description: 'Checks for missing canonical URLs to prevent duplicate content issues.',
                    prompt: 'Check if this page has a canonical tag. The rule FAILS if:\n1. The page is missing a <link rel="canonical"> tag, OR\n2. The canonical tag exists but has no href value, OR\n3. The canonical href is empty or invalid\n\nA canonical tag tells search engines which version of a page is the "master" copy.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                // TIER 2: HIGH PRIORITY
                {
                    name: 'Schema/Structured Data Check',
                    checkType: 'schema',
                    description: 'Comprehensive schema.org checks for Hotel, LocalBusiness, Organization, FAQ schemas. Critical for AI/LLM visibility.',
                    prompt: 'Check if this page has appropriate JSON-LD structured data. The rule FAILS if:\n1. The page has NO <script type="application/ld+json"> tags, OR\n2. For hotel/resort pages: Missing Hotel, LodgingBusiness, or LocalBusiness schema, OR\n3. Schema exists but is missing critical properties like name, address, or description\n\nThis is CRITICAL for AI/LLM visibility - ChatGPT and Google AI pull from structured data.',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                {
                    name: 'Thin Content Check',
                    checkType: 'content',
                    description: 'Flags pages with less than 300 words of content. Thin pages rank poorly.',
                    prompt: 'Analyze the main content (excluding navigation, headers, footers). The rule FAILS if:\n1. The page has less than approximately 300 words of actual content, OR\n2. The content is mostly duplicated/boilerplate text, OR\n3. The main content area appears empty or contains only images without supporting text\n\nFor hotel pages, there should be substantial descriptive content about property features and amenities.',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                {
                    name: 'Geo Meta Tags Check',
                    checkType: 'geo',
                    description: 'Checks for geo.region and geo.placename meta tags for location-based searches.',
                    prompt: 'Check if this page has geographic meta tags. The rule FAILS if:\n1. The page is missing BOTH geo.region and geo.placename meta tags\n\nLook for these tags:\n- <meta name="geo.region" content="US-HI">\n- <meta name="geo.placename" content="Honolulu">\n\nThese help AI travel assistants understand location context.',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                {
                    name: 'Open Graph Tags Check',
                    checkType: 'og',
                    description: 'Checks for og:image, og:title, og:description for social sharing.',
                    prompt: 'Check if this page has proper Open Graph tags. The rule FAILS if:\n1. Missing og:image tag (critical for social engagement), OR\n2. Missing og:title tag, OR\n3. Missing og:description tag\n\nLook for meta tags with property attribute:\n- <meta property="og:image" content="...">\n- <meta property="og:title" content="...">\n- <meta property="og:description" content="...">',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                // TIER 3: MEDIUM
                {
                    name: 'Image Alt Tags Check',
                    checkType: 'alt',
                    description: 'Checks for missing alt text on images for ADA accessibility compliance.',
                    prompt: 'Check if images have proper alt text for accessibility. The rule FAILS if:\n1. Multiple <img> tags are missing the alt attribute, OR\n2. Images have empty alt="" attributes (unless decorative), OR\n3. Alt text is generic like "image" instead of descriptive\n\nNote: A few missing alt tags on decorative images is acceptable. Flag only if there is a significant pattern.',
                    enabled: true,
                    severity: 'Medium',
                    tier: 3
                },
                {
                    name: 'Robots Meta Tag Check',
                    checkType: 'robots',
                    description: 'Checks for presence of robots meta tag to explicitly declare indexing instructions.',
                    prompt: 'Check if this page has a robots meta tag. The rule FAILS if:\n1. The page is missing a <meta name="robots"> tag\n\nThis is a LOW priority check - only flag if completely missing.',
                    enabled: false,
                    severity: 'Low',
                    tier: 3
                },
            ];

            const voiceRules = [
                { name: 'Warm & Welcoming', category: 'tone', description: 'Content should convey genuine Hawaiian hospitality - warm, welcoming, and relaxed. Avoid corporate jargon.', enabled: true },
                { name: 'Adventure & Discovery', category: 'tone', description: 'Inspire a sense of adventure and discovery. Highlight unique experiences and hidden gems.', enabled: true },
                { name: 'Authentic Local Voice', category: 'language', description: 'Use authentic Hawaiian and local terms appropriately (aloha, mahalo, ohana). Include cultural context.', enabled: true },
                { name: 'Sensory Language', category: 'language', description: 'Use vivid sensory language - describe sounds of waves, smell of plumeria, feel of warm sand.', enabled: true },
            ];

            const brandStandards = [
                { name: 'Brand Name Usage', standardType: 'terminology', description: 'Always use "Outrigger" not "OUTRIGGER" or "outrigger". Full name is "Outrigger Hotels & Resorts".', enabled: true },
                { name: 'Property Names', standardType: 'terminology', description: 'Use official property names exactly as registered. Include location identifiers.', enabled: true },
                { name: 'Color Palette', standardType: 'visual', description: 'Primary: Teal (#006272), Gold (#c4a35a), Sunset Orange (#e07c3e). Use consistently.', enabled: true },
                { name: 'Image Standards', standardType: 'visual', description: 'Images should be high-resolution, authentic (not stock), and showcase real guest experiences.', enabled: true },
            ];

            let added = 0;

            // Add SEO rules (or update existing ones with prompts)
            for (const rule of seoRules) {
                const existing = await db.collection('seoRules').where('checkType', '==', rule.checkType).get();
                if (existing.empty) {
                    await db.collection('seoRules').add({ ...rule, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    added++;
                } else {
                    // Update existing rule with prompt if it doesn't have one
                    const doc = existing.docs[0];
                    const data = doc.data();
                    if (!data.prompt && rule.prompt) {
                        await db.collection('seoRules').doc(doc.id).update({ prompt: rule.prompt });
                        added++;
                    }
                }
            }

            // Add Voice rules
            for (const rule of voiceRules) {
                const existing = await db.collection('voiceRules').where('name', '==', rule.name).get();
                if (existing.empty) {
                    await db.collection('voiceRules').add({ ...rule, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    added++;
                }
            }

            // Add Brand standards
            for (const standard of brandStandards) {
                const existing = await db.collection('brandStandards').where('name', '==', standard.name).get();
                if (existing.empty) {
                    await db.collection('brandStandards').add({ ...standard, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    added++;
                }
            }

            alert('Added ' + added + ' new rules/standards. Refreshing...');
            loadAllData();
        }

        // Note: Initialization is handled by the authentication code at the top of this script
    </script>
</body>
</html>
