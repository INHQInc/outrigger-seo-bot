<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Outrigger SEO Audit Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --teal: #006272;
            --gold: #c4a35a;
            --sunset: #e07c3e;
        }
        .bg-teal { background-color: var(--teal); }
        .bg-gold { background-color: var(--gold); }
        .bg-sunset { background-color: var(--sunset); }
        .text-teal { color: var(--teal); }
        .text-gold { color: var(--gold); }
        .text-sunset { color: var(--sunset); }
        .border-teal { border-color: var(--teal); }
        .border-gold { border-color: var(--gold); }
        .hover-teal:hover { background-color: var(--teal); color: white; }
        .tab-active { background-color: white; color: var(--teal); border-bottom: 3px solid var(--gold); }
        .tab-inactive { background-color: rgba(255,255,255,0.1); color: white; }
        .btn-primary { background-color: var(--teal); }
        .btn-primary:hover { background-color: #004d5a; }
        .btn-gold { background-color: var(--gold); }
        .btn-gold:hover { background-color: #a8893d; }
        .btn-sunset { background-color: var(--sunset); }
        .btn-sunset:hover { background-color: #c46a32; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-teal text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <svg class="w-10 h-10" viewBox="0 0 100 100" fill="none">
                        <circle cx="50" cy="50" r="45" fill="#c4a35a"/>
                        <path d="M30 70 L50 30 L70 70 Z" fill="#006272"/>
                        <circle cx="50" cy="55" r="8" fill="white"/>
                    </svg>
                    <div>
                        <h1 class="text-2xl font-bold">Outrigger SEO Audit Admin</h1>
                        <p class="text-sm opacity-80">Configure audit rules and brand standards</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button onclick="seedDefaultRules()" class="bg-gold text-white px-3 py-1 rounded text-sm hover:bg-opacity-80">
                        Load Default Rules
                    </button>
                    <div id="connectionStatus" class="flex items-center gap-2 text-sm">
                        <span class="w-2 h-2 rounded-full bg-yellow-400"></span>
                        <span>Connecting...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="bg-teal">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex gap-1">
                <button onclick="showTab('seo')" id="tab-seo" class="px-6 py-3 font-medium transition-all tab-active rounded-t-lg">
                    SEO/GEO Rules
                </button>
                <button onclick="showTab('voice')" id="tab-voice" class="px-6 py-3 font-medium transition-all tab-inactive rounded-t-lg">
                    Voice &amp; Tone
                </button>
                <button onclick="showTab('brand')" id="tab-brand" class="px-6 py-3 font-medium transition-all tab-inactive rounded-t-lg">
                    Brand Standards
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        <!-- SEO/GEO Rules Tab -->
        <div id="panel-seo" class="tab-panel">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-teal">SEO/GEO Check Rules</h2>
                    <button onclick="addSeoRule()" class="btn-primary text-white px-4 py-2 rounded-lg flex items-center gap-2">
                        <span>+</span> Add Rule
                    </button>
                </div>
                <div id="seoRulesList" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">Loading rules...</p>
                </div>
            </div>
        </div>

        <!-- Voice & Tone Tab -->
        <div id="panel-voice" class="tab-panel hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-teal">Voice &amp; Tone Guidelines</h2>
                    <button onclick="addVoiceRule()" class="btn-gold text-white px-4 py-2 rounded-lg flex items-center gap-2">
                        <span>+</span> Add Guideline
                    </button>
                </div>
                <div id="voiceRulesList" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">Loading guidelines...</p>
                </div>
            </div>
        </div>

        <!-- Brand Standards Tab -->
        <div id="panel-brand" class="tab-panel hidden">
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-teal">Brand Standards</h2>
                    <button onclick="addBrandStandard()" class="btn-sunset text-white px-4 py-2 rounded-lg flex items-center gap-2">
                        <span>+</span> Add Standard
                    </button>
                </div>
                <div id="brandStandardsList" class="space-y-4">
                    <p class="text-gray-500 text-center py-8">Loading standards...</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal for Adding/Editing -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <h3 id="modalTitle" class="text-xl font-bold text-teal mb-4">Add Rule</h3>
                <form id="modalForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" id="formName" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description <span class="text-gray-400 font-normal">(shown in dashboard)</span></label>
                        <textarea id="formDescription" rows="2" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent" required></textarea>
                    </div>
                    <div id="extraFields"></div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="formEnabled" class="w-4 h-4 text-teal-600 rounded" checked>
                        <label for="formEnabled" class="text-sm text-gray-700">Enabled</label>
                    </div>
                    <div class="flex gap-3 pt-4">
                        <button type="submit" class="btn-primary text-white px-6 py-2 rounded-lg flex-1">Save</button>
                        <button type="button" onclick="closeModal()" class="bg-gray-300 text-gray-700 px-6 py-2 rounded-lg">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDu4Ka6oFSUOH_7PAZW7k9-2u46SlmbBWE",
            authDomain: "project-85d26db5-f70f-487e-b0e.firebaseapp.com",
            projectId: "project-85d26db5-f70f-487e-b0e",
            storageBucket: "project-85d26db5-f70f-487e-b0e.firebasestorage.app",
            messagingSenderId: "22338575803",
            appId: "1:22338575803:web:58fef3f290892f25c5f89e"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // State
        let currentTab = 'seo';
        let currentEditId = null;
        let currentCollection = null;

        // Update connection status
        function updateConnectionStatus(connected) {
            var statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-green-400"></span><span>Connected to Firestore</span>';
            } else {
                statusEl.innerHTML = '<span class="w-2 h-2 rounded-full bg-red-400"></span><span>Connection Error</span>';
            }
        }

        // Tab Navigation
        function showTab(tabName) {
            currentTab = tabName;
            var tabs = ['seo', 'voice', 'brand'];
            tabs.forEach(function(tab) {
                var tabBtn = document.getElementById('tab-' + tab);
                var panel = document.getElementById('panel-' + tab);
                if (tab === tabName) {
                    tabBtn.className = 'px-6 py-3 font-medium transition-all tab-active rounded-t-lg';
                    panel.classList.remove('hidden');
                } else {
                    tabBtn.className = 'px-6 py-3 font-medium transition-all tab-inactive rounded-t-lg';
                    panel.classList.add('hidden');
                }
            });
        }

        // Load SEO Rules
        function loadSeoRules() {
            var container = document.getElementById('seoRulesList');
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Loading rules...</p>';

            db.collection('seoRules').orderBy('name').get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">No SEO rules configured. Click "Add Rule" to create one.</p>';
                        return;
                    }
                    var html = '';
                    snapshot.forEach(function(doc) {
                        var rule = doc.data();
                        html += createRuleCard(doc.id, rule, 'seo');
                    });
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading SEO rules:', error);
                    updateConnectionStatus(false);
                    container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading rules. Check console for details.</p>';
                });
        }

        // Load Voice Rules
        function loadVoiceRules() {
            var container = document.getElementById('voiceRulesList');
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Loading guidelines...</p>';

            db.collection('voiceRules').orderBy('name').get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">No voice guidelines configured. Click "Add Guideline" to create one.</p>';
                        return;
                    }
                    var html = '';
                    snapshot.forEach(function(doc) {
                        var rule = doc.data();
                        html += createRuleCard(doc.id, rule, 'voice');
                    });
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading voice rules:', error);
                    updateConnectionStatus(false);
                    container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading guidelines. Check console for details.</p>';
                });
        }

        // Load Brand Standards
        function loadBrandStandards() {
            var container = document.getElementById('brandStandardsList');
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Loading standards...</p>';

            db.collection('brandStandards').orderBy('name').get()
                .then(function(snapshot) {
                    updateConnectionStatus(true);
                    if (snapshot.empty) {
                        container.innerHTML = '<p class="text-gray-500 text-center py-8">No brand standards configured. Click "Add Standard" to create one.</p>';
                        return;
                    }
                    var html = '';
                    snapshot.forEach(function(doc) {
                        var standard = doc.data();
                        html += createRuleCard(doc.id, standard, 'brand');
                    });
                    container.innerHTML = html;
                })
                .catch(function(error) {
                    console.error('Error loading brand standards:', error);
                    updateConnectionStatus(false);
                    container.innerHTML = '<p class="text-red-500 text-center py-8">Error loading standards. Check console for details.</p>';
                });
        }

        // Create rule card HTML
        function createRuleCard(id, data, type) {
            var statusClass = data.enabled ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600';
            var statusText = data.enabled ? 'Enabled' : 'Disabled';
            var borderColor = type === 'seo' ? 'border-l-teal' : (type === 'voice' ? 'border-l-4 border-l-[#c4a35a]' : 'border-l-4 border-l-[#e07c3e]');

            // Badge for LLM-powered rules
            var llmBadge = '';
            if (data.prompt) {
                llmBadge = '<span class="px-2 py-1 text-xs rounded-full bg-purple-100 text-purple-800">ðŸ¤– AI-Powered</span>';
            }

            // Severity badge for SEO rules
            var severityBadge = '';
            if (data.severity) {
                var severityClass = {
                    'Critical': 'bg-red-100 text-red-800',
                    'High': 'bg-orange-100 text-orange-800',
                    'Medium': 'bg-yellow-100 text-yellow-800',
                    'Low': 'bg-blue-100 text-blue-800'
                }[data.severity] || 'bg-gray-100 text-gray-800';
                severityBadge = '<span class="px-2 py-1 text-xs rounded-full ' + severityClass + '">' + data.severity + '</span>';
            }

            return '<div class="border rounded-lg p-4 ' + borderColor + ' border-l-4 hover:shadow-md transition-shadow">' +
                '<div class="flex justify-between items-start">' +
                    '<div class="flex-1">' +
                        '<div class="flex items-center gap-2 mb-2 flex-wrap">' +
                            '<h3 class="font-semibold text-gray-900">' + escapeHtml(data.name) + '</h3>' +
                            '<span class="px-2 py-1 text-xs rounded-full ' + statusClass + '">' + statusText + '</span>' +
                            severityBadge +
                            llmBadge +
                        '</div>' +
                        '<p class="text-gray-600 text-sm">' + escapeHtml(data.description) + '</p>' +
                    '</div>' +
                    '<div class="flex gap-2 ml-4">' +
                        '<button onclick="editRule(\'' + type + '\', \'' + id + '\')" class="text-teal hover:bg-gray-100 p-2 rounded">Edit</button>' +
                        '<button onclick="deleteRule(\'' + type + '\', \'' + id + '\')" class="text-red-600 hover:bg-red-50 p-2 rounded">Delete</button>' +
                    '</div>' +
                '</div>' +
            '</div>';
        }

        // Escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            var div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Modal functions
        function openModal(title, collection) {
            currentCollection = collection;
            currentEditId = null;
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('formName').value = '';
            document.getElementById('formDescription').value = '';
            document.getElementById('formEnabled').checked = true;
            document.getElementById('extraFields').innerHTML = '';
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('modal').classList.add('flex');
        }

        function closeModal() {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
            currentEditId = null;
            currentCollection = null;
        }

        // Add functions
        function addSeoRule() {
            openModal('Add SEO/GEO Rule', 'seoRules');
            document.getElementById('extraFields').innerHTML =
                '<div class="mb-4">' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Check Type <span class="text-gray-400 font-normal">(identifier)</span></label>' +
                    '<select id="formCheckType" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="title">Title Tag</option>' +
                        '<option value="meta">Meta Description</option>' +
                        '<option value="h1">H1 Heading</option>' +
                        '<option value="canonical">Canonical Tag</option>' +
                        '<option value="schema">Schema/Structured Data</option>' +
                        '<option value="content">Content Quality</option>' +
                        '<option value="geo">Geo Meta Tags</option>' +
                        '<option value="og">Open Graph Tags</option>' +
                        '<option value="alt">Image Alt Tags</option>' +
                        '<option value="robots">Robots Meta Tag</option>' +
                        '<option value="custom">Custom (LLM-only)</option>' +
                    '</select>' +
                '</div>' +
                '<div class="mb-4">' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Severity</label>' +
                    '<select id="formSeverity" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="Critical">Critical</option>' +
                        '<option value="High">High</option>' +
                        '<option value="Medium" selected>Medium</option>' +
                        '<option value="Low">Low</option>' +
                    '</select>' +
                '</div>' +
                '<div class="mb-4">' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">LLM Audit Prompt <span class="text-gray-400 font-normal">(optional - enables AI-powered checking)</span></label>' +
                    '<textarea id="formPrompt" rows="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent font-mono text-sm" placeholder="Describe what the AI should check for. Example:\n\nCheck if this page has a proper <title> tag. The rule FAILS if:\n1. The page is missing a <title> tag\n2. The title is less than 30 characters\n3. The title is generic like &quot;Home&quot;"></textarea>' +
                    '<p class="text-xs text-gray-500 mt-1">When a prompt is provided, Claude AI will evaluate the page against this rule dynamically. Leave empty to use built-in hardcoded checks.</p>' +
                '</div>';
        }

        function addVoiceRule() {
            openModal('Add Voice Guideline', 'voiceRules');
            document.getElementById('extraFields').innerHTML =
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Category</label>' +
                    '<select id="formCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="tone">Tone of Voice</option>' +
                        '<option value="language">Language Style</option>' +
                        '<option value="audience">Target Audience</option>' +
                        '<option value="messaging">Key Messaging</option>' +
                    '</select>' +
                '</div>';
        }

        function addBrandStandard() {
            openModal('Add Brand Standard', 'brandStandards');
            document.getElementById('extraFields').innerHTML =
                '<div>' +
                    '<label class="block text-sm font-medium text-gray-700 mb-1">Standard Type</label>' +
                    '<select id="formStandardType" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                        '<option value="visual">Visual Identity</option>' +
                        '<option value="terminology">Terminology</option>' +
                        '<option value="compliance">Compliance</option>' +
                        '<option value="accessibility">Accessibility</option>' +
                    '</select>' +
                '</div>';
        }

        // Edit rule
        function editRule(type, id) {
            var collectionName = type === 'seo' ? 'seoRules' : (type === 'voice' ? 'voiceRules' : 'brandStandards');
            currentCollection = collectionName;
            currentEditId = id;

            db.collection(collectionName).doc(id).get()
                .then(function(doc) {
                    if (doc.exists) {
                        var data = doc.data();
                        document.getElementById('modalTitle').textContent = 'Edit ' + data.name;
                        document.getElementById('formName').value = data.name || '';
                        document.getElementById('formDescription').value = data.description || '';
                        document.getElementById('formEnabled').checked = data.enabled !== false;

                        // Build extra fields based on type
                        if (type === 'seo') {
                            document.getElementById('extraFields').innerHTML =
                                '<div class="mb-4">' +
                                    '<label class="block text-sm font-medium text-gray-700 mb-1">Check Type</label>' +
                                    '<select id="formCheckType" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                                        '<option value="title"' + (data.checkType === 'title' ? ' selected' : '') + '>Title Tag</option>' +
                                        '<option value="meta"' + (data.checkType === 'meta' ? ' selected' : '') + '>Meta Description</option>' +
                                        '<option value="h1"' + (data.checkType === 'h1' ? ' selected' : '') + '>H1 Heading</option>' +
                                        '<option value="canonical"' + (data.checkType === 'canonical' ? ' selected' : '') + '>Canonical Tag</option>' +
                                        '<option value="schema"' + (data.checkType === 'schema' ? ' selected' : '') + '>Schema/Structured Data</option>' +
                                        '<option value="content"' + (data.checkType === 'content' ? ' selected' : '') + '>Content Quality</option>' +
                                        '<option value="geo"' + (data.checkType === 'geo' ? ' selected' : '') + '>Geo Meta Tags</option>' +
                                        '<option value="og"' + (data.checkType === 'og' ? ' selected' : '') + '>Open Graph Tags</option>' +
                                        '<option value="alt"' + (data.checkType === 'alt' ? ' selected' : '') + '>Image Alt Tags</option>' +
                                        '<option value="robots"' + (data.checkType === 'robots' ? ' selected' : '') + '>Robots Meta Tag</option>' +
                                        '<option value="custom"' + (data.checkType === 'custom' ? ' selected' : '') + '>Custom (LLM-only)</option>' +
                                    '</select>' +
                                '</div>' +
                                '<div class="mb-4">' +
                                    '<label class="block text-sm font-medium text-gray-700 mb-1">Severity</label>' +
                                    '<select id="formSeverity" class="w-full border border-gray-300 rounded-lg px-3 py-2">' +
                                        '<option value="Critical"' + (data.severity === 'Critical' ? ' selected' : '') + '>Critical</option>' +
                                        '<option value="High"' + (data.severity === 'High' ? ' selected' : '') + '>High</option>' +
                                        '<option value="Medium"' + (data.severity === 'Medium' || !data.severity ? ' selected' : '') + '>Medium</option>' +
                                        '<option value="Low"' + (data.severity === 'Low' ? ' selected' : '') + '>Low</option>' +
                                    '</select>' +
                                '</div>' +
                                '<div class="mb-4">' +
                                    '<label class="block text-sm font-medium text-gray-700 mb-1">LLM Audit Prompt <span class="text-gray-400 font-normal">(optional)</span></label>' +
                                    '<textarea id="formPrompt" rows="6" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-teal-500 focus:border-transparent font-mono text-sm">' + escapeHtml(data.prompt || '') + '</textarea>' +
                                    '<p class="text-xs text-gray-500 mt-1">When a prompt is provided, Claude AI will evaluate the page against this rule dynamically.</p>' +
                                '</div>';
                        } else {
                            document.getElementById('extraFields').innerHTML = '';
                        }

                        document.getElementById('modal').classList.remove('hidden');
                        document.getElementById('modal').classList.add('flex');
                    }
                })
                .catch(function(error) {
                    console.error('Error loading rule:', error);
                    alert('Error loading rule for editing');
                });
        }

        // Delete rule
        function deleteRule(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;

            var collectionName = type === 'seo' ? 'seoRules' : (type === 'voice' ? 'voiceRules' : 'brandStandards');

            db.collection(collectionName).doc(id).delete()
                .then(function() {
                    loadAllData();
                })
                .catch(function(error) {
                    console.error('Error deleting:', error);
                    alert('Error deleting item');
                });
        }

        // Form submission
        document.getElementById('modalForm').addEventListener('submit', function(e) {
            e.preventDefault();

            var data = {
                name: document.getElementById('formName').value,
                description: document.getElementById('formDescription').value,
                enabled: document.getElementById('formEnabled').checked,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Add extra fields based on collection
            var checkType = document.getElementById('formCheckType');
            var category = document.getElementById('formCategory');
            var standardType = document.getElementById('formStandardType');
            var severity = document.getElementById('formSeverity');
            var prompt = document.getElementById('formPrompt');

            if (checkType) data.checkType = checkType.value;
            if (category) data.category = category.value;
            if (standardType) data.standardType = standardType.value;
            if (severity) data.severity = severity.value;
            if (prompt && prompt.value.trim()) {
                data.prompt = prompt.value.trim();
            }

            var savePromise;
            if (currentEditId) {
                savePromise = db.collection(currentCollection).doc(currentEditId).update(data);
            } else {
                data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
                savePromise = db.collection(currentCollection).add(data);
            }

            savePromise
                .then(function() {
                    closeModal();
                    loadAllData();
                })
                .catch(function(error) {
                    console.error('Error saving:', error);
                    alert('Error saving: ' + error.message);
                });
        });

        // Load all data
        function loadAllData() {
            loadSeoRules();
            loadVoiceRules();
            loadBrandStandards();
        }

        // Seed default rules (run once to populate)
        async function seedDefaultRules() {
            if (!confirm('This will add all recommended SEO/GEO rules with AI-powered prompts. Continue?')) return;

            const seoRules = [
                // TIER 1: CRITICAL - All with LLM prompts
                {
                    name: 'Title Tag Check',
                    checkType: 'title',
                    description: 'Checks for missing or too-short title tags. Title should be 50-60 characters and include primary keywords.',
                    prompt: 'Check if this page has a proper <title> tag. The rule FAILS if:\n1. The page is missing a <title> tag entirely, OR\n2. The title is empty or contains only whitespace, OR\n3. The title is less than 30 characters (too short to be descriptive), OR\n4. The title is generic like "Home" or "Page" without context\n\nFor a hotel/hospitality site, a good title should include the property name, location, and ideally brand.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                {
                    name: 'Meta Description Check',
                    checkType: 'meta',
                    description: 'Checks for missing or too-short meta descriptions. Should be 150-160 characters with compelling copy.',
                    prompt: 'Check if this page has a proper meta description. The rule FAILS if:\n1. The page is missing a <meta name="description"> tag, OR\n2. The meta description content is empty, OR\n3. The meta description is less than 120 characters (too short), OR\n4. The meta description is over 160 characters (will be truncated)\n\nFor a hotel site, meta descriptions should be compelling and include a call-to-action.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                {
                    name: 'H1 Tag Check',
                    checkType: 'h1',
                    description: 'Checks for missing H1 tags or multiple H1s. Each page should have exactly one H1.',
                    prompt: 'Check if this page has proper H1 heading structure. The rule FAILS if:\n1. The page has NO <h1> tag at all, OR\n2. The page has MORE than one <h1> tag (should have exactly one), OR\n3. The H1 is empty or contains only whitespace\n\nBest practice: Each page should have exactly one H1 that clearly describes the main topic.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                {
                    name: 'Canonical Tag Check',
                    checkType: 'canonical',
                    description: 'Checks for missing canonical URLs to prevent duplicate content issues.',
                    prompt: 'Check if this page has a canonical tag. The rule FAILS if:\n1. The page is missing a <link rel="canonical"> tag, OR\n2. The canonical tag exists but has no href value, OR\n3. The canonical href is empty or invalid\n\nA canonical tag tells search engines which version of a page is the "master" copy.',
                    enabled: true,
                    severity: 'Critical',
                    tier: 1
                },
                // TIER 2: HIGH PRIORITY
                {
                    name: 'Schema/Structured Data Check',
                    checkType: 'schema',
                    description: 'Comprehensive schema.org checks for Hotel, LocalBusiness, Organization, FAQ schemas. Critical for AI/LLM visibility.',
                    prompt: 'Check if this page has appropriate JSON-LD structured data. The rule FAILS if:\n1. The page has NO <script type="application/ld+json"> tags, OR\n2. For hotel/resort pages: Missing Hotel, LodgingBusiness, or LocalBusiness schema, OR\n3. Schema exists but is missing critical properties like name, address, or description\n\nThis is CRITICAL for AI/LLM visibility - ChatGPT and Google AI pull from structured data.',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                {
                    name: 'Thin Content Check',
                    checkType: 'content',
                    description: 'Flags pages with less than 300 words of content. Thin pages rank poorly.',
                    prompt: 'Analyze the main content (excluding navigation, headers, footers). The rule FAILS if:\n1. The page has less than approximately 300 words of actual content, OR\n2. The content is mostly duplicated/boilerplate text, OR\n3. The main content area appears empty or contains only images without supporting text\n\nFor hotel pages, there should be substantial descriptive content about property features and amenities.',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                {
                    name: 'Geo Meta Tags Check',
                    checkType: 'geo',
                    description: 'Checks for geo.region and geo.placename meta tags for location-based searches.',
                    prompt: 'Check if this page has geographic meta tags. The rule FAILS if:\n1. The page is missing BOTH geo.region and geo.placename meta tags\n\nLook for these tags:\n- <meta name="geo.region" content="US-HI">\n- <meta name="geo.placename" content="Honolulu">\n\nThese help AI travel assistants understand location context.',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                {
                    name: 'Open Graph Tags Check',
                    checkType: 'og',
                    description: 'Checks for og:image, og:title, og:description for social sharing.',
                    prompt: 'Check if this page has proper Open Graph tags. The rule FAILS if:\n1. Missing og:image tag (critical for social engagement), OR\n2. Missing og:title tag, OR\n3. Missing og:description tag\n\nLook for meta tags with property attribute:\n- <meta property="og:image" content="...">\n- <meta property="og:title" content="...">\n- <meta property="og:description" content="...">',
                    enabled: true,
                    severity: 'High',
                    tier: 2
                },
                // TIER 3: MEDIUM
                {
                    name: 'Image Alt Tags Check',
                    checkType: 'alt',
                    description: 'Checks for missing alt text on images for ADA accessibility compliance.',
                    prompt: 'Check if images have proper alt text for accessibility. The rule FAILS if:\n1. Multiple <img> tags are missing the alt attribute, OR\n2. Images have empty alt="" attributes (unless decorative), OR\n3. Alt text is generic like "image" instead of descriptive\n\nNote: A few missing alt tags on decorative images is acceptable. Flag only if there is a significant pattern.',
                    enabled: true,
                    severity: 'Medium',
                    tier: 3
                },
                {
                    name: 'Robots Meta Tag Check',
                    checkType: 'robots',
                    description: 'Checks for presence of robots meta tag to explicitly declare indexing instructions.',
                    prompt: 'Check if this page has a robots meta tag. The rule FAILS if:\n1. The page is missing a <meta name="robots"> tag\n\nThis is a LOW priority check - only flag if completely missing.',
                    enabled: false,
                    severity: 'Low',
                    tier: 3
                },
            ];

            const voiceRules = [
                { name: 'Warm & Welcoming', category: 'tone', description: 'Content should convey genuine Hawaiian hospitality - warm, welcoming, and relaxed. Avoid corporate jargon.', enabled: true },
                { name: 'Adventure & Discovery', category: 'tone', description: 'Inspire a sense of adventure and discovery. Highlight unique experiences and hidden gems.', enabled: true },
                { name: 'Authentic Local Voice', category: 'language', description: 'Use authentic Hawaiian and local terms appropriately (aloha, mahalo, ohana). Include cultural context.', enabled: true },
                { name: 'Sensory Language', category: 'language', description: 'Use vivid sensory language - describe sounds of waves, smell of plumeria, feel of warm sand.', enabled: true },
            ];

            const brandStandards = [
                { name: 'Brand Name Usage', standardType: 'terminology', description: 'Always use "Outrigger" not "OUTRIGGER" or "outrigger". Full name is "Outrigger Hotels & Resorts".', enabled: true },
                { name: 'Property Names', standardType: 'terminology', description: 'Use official property names exactly as registered. Include location identifiers.', enabled: true },
                { name: 'Color Palette', standardType: 'visual', description: 'Primary: Teal (#006272), Gold (#c4a35a), Sunset Orange (#e07c3e). Use consistently.', enabled: true },
                { name: 'Image Standards', standardType: 'visual', description: 'Images should be high-resolution, authentic (not stock), and showcase real guest experiences.', enabled: true },
            ];

            let added = 0;

            // Add SEO rules (or update existing ones with prompts)
            for (const rule of seoRules) {
                const existing = await db.collection('seoRules').where('checkType', '==', rule.checkType).get();
                if (existing.empty) {
                    await db.collection('seoRules').add({ ...rule, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    added++;
                } else {
                    // Update existing rule with prompt if it doesn't have one
                    const doc = existing.docs[0];
                    const data = doc.data();
                    if (!data.prompt && rule.prompt) {
                        await db.collection('seoRules').doc(doc.id).update({ prompt: rule.prompt });
                        added++;
                    }
                }
            }

            // Add Voice rules
            for (const rule of voiceRules) {
                const existing = await db.collection('voiceRules').where('name', '==', rule.name).get();
                if (existing.empty) {
                    await db.collection('voiceRules').add({ ...rule, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    added++;
                }
            }

            // Add Brand standards
            for (const standard of brandStandards) {
                const existing = await db.collection('brandStandards').where('name', '==', standard.name).get();
                if (existing.empty) {
                    await db.collection('brandStandards').add({ ...standard, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    added++;
                }
            }

            alert('Added ' + added + ' new rules/standards. Refreshing...');
            loadAllData();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadAllData();
        });
    </script>
</body>
</html>
